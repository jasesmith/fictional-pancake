!function(e,a,t){"use strict";e.module("app").controller("mainController",["$scope",function(e){e.date=null;var t=function(e){console.log("caendar action clicked!",e),window.alert("Pancake says:\n\nload an actual calendar\nselect: "+e.format("MMM D, YYYY"))};e.config={useWeekendAlert:!1,allowBeforeToday:!1,calendarAction:t,text:{diff:0,today:"today",date:"",day:"",when:""}},e.setDate={month:a().month(),day:a().date(),year:a().year()},e.$watch("setDate",function(t){e.$broadcast("set:date",a([t.year,t.month,t.day]))},!0),e.format=function(e){return new Date(e)},e.reset=function(a){e.$broadcast("reset:date",a)}}]).directive("tap",[function(){return function(e,a,n){var d=new t(a[0],{});d.on("tap",function(){e.$apply(function(){e.$eval(n.tap)})})}}]).directive("calendarDial",["UiHelpers",function(n){var d=function(a,t,n){var d=n?"translate(-50%, -50%) ":"";e.element(a).css({transform:d+"rotate("+t+"deg)"})},o=function(e,a,t){var n=e-Math.floor(Math.abs(a+t/2)/t),d=0===n?e:1>e-n?1:e-n>e?e:e-n;return d},s=function(e,a){return n.maxDegrees/e*a};return{restrict:"E",replace:!0,scope:{date:"=?",config:"=?"},template:'<div class="calendar-dial bezel" ng-class="setClasses()"><div class="lcd"><div class="day">{{config.text.day}}</div><div class="when">{{config.text.when}}</div></div><div ng-if="config.calendarAction" tap="config.calendarAction(date)" class="icon calendar-action fa fa-calendar-o"></div><div ng-if="config.useWeekendAlert" class="icon weekend-alert fa fa-exclamation-circle"></div><div class="crown today"><span><span data-title="{{config.text.today}}"></span></span></div><div class="crown step"><span>{{config.text.diff}}</span></div></div>',link:function(c,r){var i=31;c.format=function(e){return new Date(e)};var l=e.element(r[0].querySelector(".step")),f=e.element(r[0].querySelector(".lcd")),u={deg:0,max:i,step:n.maxDegrees/i,element:l,handle:e.element(r[0].querySelector(".step > span")),canvas:r},y={deg:0,max:i,step:n.maxDegrees/i,element:e.element(r[0].querySelector(".today")),handle:e.element(r[0].querySelector(".today > span")),label:e.element(r[0].querySelector(".today > span span")),canvas:r},g=function(e){c.weekday=e.isoWeekday(),c.weekend=6===c.weekday||7===c.weekday},h=function(e,a){var t=e.diff(c.today,"days"),n=c.thisYear!==e.year()?"MMMM D, YYYY":"MMMM D",d="ddd, MMM D";return{diff:t>0?"+"+t:t,today:Math.abs(t)>1?"today":"",when:0===t||1===t?e.format(d):e.fromNow(),date:e.format(n),day:e.calendar(c.today,{lastWeek:d,lastDay:"[Yesterday]",sameDay:"[Today]",nextDay:"[Tomorrow]",nextWeek:d,sameElse:d})}},v=function(e){(!c.date||e)&&(c.isPast=!1,c.date=a().add(1,"day").startOf("day"),c.config.useWeekendAlert&&(6===c.date.isoWeekday()&&c.date.add(1,"day"),7===c.date.isoWeekday()&&c.date.add(1,"day"))),g(c.date),c.today=a().startOf("day"),c.thisYear=c.today.year();var t=s(i,c.today.date());y.deg=t,d(y.element[0],t);var n=s(i,c.date.date());u.deg=n,d(u.element[0],n),d(u.handle[0],-n,!0),c.config.text=h(c.date,"date")},p,m,w,x,D,M=0,k=0,T=0,Y,E,W,b=function(e,a,t){w=n.maxDegrees/a,m=e.srcEvent&&e.srcEvent.changedTouches?e.srcEvent.changedTouches:e.pointers,k=n.getDegrees(m[0],r[0]),T=t.deg},A=function(e){m=e.srcEvent&&e.srcEvent.changedTouches?e.srcEvent.changedTouches:e.pointers,Y=n.getDegrees(m[0],r[0]),E=Y-k,W=T+E,W=isNaN(W)?T:W,W=0>=W?n.maxDegrees-Math.abs(W):W,W=W>=n.maxDegrees?W-n.maxDegrees:W,k=Y,T=W};c.touching=!1;var P=new t(u.canvas[0]),q=new t(f[0],{});P.get("pan").set({direction:t.DIRECTION_ALL,threshold:0}),P.on("panstart",function(e){c.touching=e.srcEvent&&e.srcEvent.changedTouches?!0:!1,c.active=!0,b(e,i,u)}).on("pan panmove",function(e){A(e),p=x,D=c.date.daysInMonth(),x=o(D,W,w),M=c.date.diff(c.today,"days"),c.isPast=0>M,x&&p&&p!==x&&(1===p&&x>2?(c.date=c.date.subtract(1,"month"),x=c.date.daysInMonth()):1===x&&p>2&&(c.date.add(1,"month"),D=c.date.daysInMonth()),c.date.date(x)),d(u.element[0],W),d(u.handle[0],-W,!0),c.config.text=h(c.date),g(c.date),c.$apply()}).on("panend pancancel",function(){c.touching=!1,c.active=!1,c.isPast&&!c.config.allowBeforeToday&&(x=c.today.date(),c.date=a(c.today),c.config.text=h(c.date),g(c.date),c.isPast=!1),u.deg=x*w,d(u.element[0],u.deg),d(u.handle[0],-u.deg,!0),c.$apply()}),c.setClasses=function(){var e=[];return c.weekday&&e.push("weekday-"+c.weekday),c.isPast&&!c.config.allowBeforeToday&&e.push("is-past"),c.active&&e.push("active"),c.touching&&e.push("touch"),c.config.useWeekendAlert&&c.weekend&&e.push("is-weekend"),c.config.calendarAction&&e.push("has-calendar"),e.join(" ")},v(),c.$on("reset:date",function(e){e&&(c.date=a(e)),v(!0)})}}}]).factory("UiHelpers",[function(){var e=360,a=6.283185307179586,t=function(e){var a={};return e&&(a={t:e.offsetTop,r:e.offsetLeft+e.offsetWidth,b:e.offsetTop+e.offsetHeight,l:e.offsetLeft,w:e.offsetWidth,h:e.offsetHeight},a.cx=a.l+a.w/2,a.cy=a.t+a.h/2),a},n=function(e,n){var d=t(n),o=Math.atan2(e.clientY-d.cy,e.clientX-d.cx);return o+=a/4,0>o&&(o+=a),o},d=function(e,a){var t=n(e,a),d=180*t/Math.PI;return d};return{maxRadians:a,maxDegrees:e,getNumbers:t,getRadians:n,getDegrees:d}}])}(window.angular,window.moment,window.Hammer);